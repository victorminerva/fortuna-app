<!DOCTYPE html>
<html>
<head>
    <title>Fortuna</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="container my-5">
    <h1>Folha</h1>

    <form id="submitForm" method="post">
        <div id="inputsContainer">
            <!-- Initial input field -->
            <div class="input-group mb-3">
                <input type="text" name="numbers" class="form-control" id="winningNumbersPaper" placeholder="01 - 02 - 03 - 04 - 05 - 06 - 07 - 08 - 09 - 10 - 11 - 12 - 13 - 14 - 15">
                <div class="input-group-append">
                    <button class="btn btn-danger delete-input" type="button">-</button>
                </div>
            </div>
        </div>
        <button type="button" id="addInput" class="btn btn-primary">+</button>
        <div class="text-right">
            <button type="button" id="submitBtn" class="btn btn-primary">Salvar</button>
        </div>
    </form>

    <script>
        $(document).ready(function() {
             $('#addInput').click(function() {
                var newInput = '<div class="input-group mb-3">' +
                               '<input type="text" name="numbers" class="form-control" id="winningNumbersPaper" placeholder="01 - 02 - 03 - 04 - 05 - 06 - 07 - 08 - 09 - 10 - 11 - 12 - 13 - 14 - 15">' +
                               '<div class="input-group-append">' +
                               '<button class="btn btn-danger delete-input" type="button">-</button>' +
                               '</div>' +
                               '</div>';
                $('#inputsContainer').append(newInput);
            });

            $(document).on('click', '.delete-input', function() {
                $(this).closest('.input-group').remove();
            });

            $('#inputsContainer').on('input', 'input[type="text"]', function() {
                var input = $(this);
                var value = input.val().replace(/[^0-9]/g, '');
                var pairs = value.match(/.{1,2}/g) || [];
                if (pairs.length > 15) {
                    pairs = pairs.slice(0, 15);
                }
                input.val(pairs.join(' - '));
            });

            $('#submitBtn').click(function() {
                var formData = $('#submitForm').serialize();
                const params = new URLSearchParams(formData);
                const numbersValues = params.getAll('numbers');

                let jsonObject = {
                    "bets": numbersValues.map(number => ({
                        "numbers": number.split(' - ').map(number => parseInt(number, 10))
                    }))
                };

                console.log(jsonObject)
                fetch('http://localhost:8080/api/papers', {
                     method: 'POST',
                     headers: {
                        'Content-Type': 'application/json',
                     },
                     body: JSON.stringify(jsonObject),
                    })
                    .then(response => response.json())
                    .then(data => console.log(data))
                    .catch((error) => {
                     console.error('Error:', error);
                });
            });
        });
    </script>
</div>
</body>
</html>
